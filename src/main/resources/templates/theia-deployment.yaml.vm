# FILE: theia-deployment.yaml.vm
apiVersion: apps/v1
kind: Deployment
metadata:
  name: ${deploymentName}
  namespace: ${namespace}
  labels:
    app: theia
    session-name: ${sessionName}
spec:
  replicas: 1
  selector:
    matchLabels:
      app: theia
      session-name: ${sessionName}
  template:
    metadata:
      labels:
        app: theia
        session-name: ${sessionName}
    spec:
      automountServiceAccountToken: false
      securityContext:
        fsGroup: ${fsGroupUid}
      volumes:
        - name: workspace
          persistentVolumeClaim:
            claimName: ${pvcName}
      containers:
        - name: theia
          image: ${image}
          imagePullPolicy: IfNotPresent
          ports:
            - containerPort: ${port}
              name: http
          resources:
            requests:
              cpu: ${requestsCpu}
              memory: ${requestsMemory}
            limits:
              cpu: ${limitsCpu}
              memory: ${limitsMemory}
          env:
#foreach($env in $envs)
            - name: $env.name
              value: "$env.value"
#end
          # New: pull envs from ConfigMaps / Secrets listed in Session spec
#if( $envVarsFromConfigMaps || $envVarsFromSecrets )
          envFrom:
#foreach($cm in $envVarsFromConfigMaps)
              - configMapRef:
                  name: $cm
#end
#foreach($sec in $envVarsFromSecrets)
              - secretRef:
                  name: $sec
#end
#end
          volumeMounts:
            - name: workspace
              mountPath: ${mountPath}
          securityContext:
            runAsUser: ${runAsUid}
            runAsGroup: ${runAsUid}
